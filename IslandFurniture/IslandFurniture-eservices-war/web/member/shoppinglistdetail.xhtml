<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:pf="http://primefaces.org/ui">
<h:body>
    <ui:composition template="../template.xhtml">
        <ui:define name="content">
        <section>
            <div class="container">
                <h:panelGroup layout="block" rendered="#{empty shoppingListDetailManagedBean.shoppingList.id}" style="height:410px;" styleClass="row">
                    <div class="col-md-12">
                        <h2>This shopping list does not exist in this country's site!</h2>
                        <hr/>
                        <h4>Create a new shopping list instead!</h4>
                            <a href="shoppinglist.xhtml" class="btn btn-default btn-round">
                                <i class="fa fa-shopping-cart"></i> My Shopping Lists
                            </a>
                    </div>
                </h:panelGroup>                
                <h:panelGroup layout="block" rendered="#{not empty shoppingListDetailManagedBean.shoppingList.id}" styleClass="row">
                    <div class="col-md-12">
                        <ol class="breadcrumb">
                          <li><a href="index.xhtml">Home</a></li>
                          <li><a href="shoppinglist.xhtml">Shopping Lists</a></li>
                          <li class="active"><strong>#{shoppingListDetailManagedBean.shoppingList.name}</strong></li>
                        </ol>
                        <h:form id="editShoppingList">
                            <div class="input-group pull-right" style="max-width: 250px;">
                                <h:selectOneMenu id="storeId" class="form-control needauto" value="#{shoppingListDetailManagedBean.shoppingList.store.id}">
                                    <f:selectItems value="#{shoppingListDetailManagedBean.countryOffice.stores}" var="s" itemLabel="#{s.name}" itemValue="#{s.id}" />
                                </h:selectOneMenu>
                              <span class="input-group-btn">
                                  <h:commandButton action="#{shoppingListDetailManagedBean.editListStore}" value="Save" class="btn btn-default" style="height:35px;">
                                  </h:commandButton>
                              </span>
                            </div>
                        </h:form>                      
                        <h3>#{shoppingListDetailManagedBean.shoppingList.name}</h3>
                        <hr/>
                    </div> 
                    <div class="col-md-12">
                    <div class="table-responsive list_info">
                        <table class="table table-condensed">
                            <thead>
                            <tr class="list_menu">
                                <td class="image">Item</td>
                                <td class="description"></td>
                                <td class="description">#{shoppingListDetailManagedBean.shoppingList.store.name} Store Section</td>
                                <td class="price">Price 
                                    (#{shoppingListDetailManagedBean.countryOffice.country.currency.currencyCode})</td>
                                <td class="quantity">Quantity</td>
                                <td>Update</td>
                                <td>Remove</td>
                            </tr>
                            </thead>
                            <tbody>
                                <h:form id="viewListDetails">
                                <ui:repeat value="#{shoppingListDetailManagedBean.shoppingListDetails}" var="detail">
                                <tr>
                                    <td class="list_product">
                                        <a href="../productdetail.xhtml?id=#{detail.furnitureModel.id}">
                                            <pf:graphicImage value="#{pictureManagedBean.image}" rendered="#{not empty detail.furnitureModel.thumbnail.content}">
                                                <f:param name="pictureId" value="#{detail.furnitureModel.thumbnail.id}" />
                                            </pf:graphicImage>
                                            <h:panelGroup layout="block" rendered="#{empty detail.furnitureModel.thumbnail.content}">
                                                <img src="#{application.contextPath}/assets/images/nopic.jpg" alt="" />
                                            </h:panelGroup>
                                        </a>
                                    </td>
                                    <td class="list_description">
                                        <h4><a href="../productdetail.xhtml?id=#{detail.furnitureModel.id}">#{detail.furnitureModel.name}</a></h4>
                                        <p>#{detail.furnitureModel.category}</p>
                                    </td>
                                    <td class="list_description">
                                        <p><i class="fa fa-map-marker"></i> #{shoppingListDetailManagedBean.getLocation(detail.furnitureModel.id)}</p>
                                    </td>                                    
                                    <td class="list_price">
                                        <p>
                                            <h:outputText value="#{shoppingListDetailManagedBean.getDiscountedPrice(detail.furnitureModel)}" id="discounted">
                                                <f:convertNumber type="number" groupingUsed="true" minFractionDigits="2" pattern="#0.00"/>
                                            </h:outputText> 
                                            <small>
                                                <h:outputText value="#{detail.furnitureModel.price}" style="text-decoration: line-through;" 
                                                    rendered="#{detail.furnitureModel.price > shoppingListDetailManagedBean.getDiscountedPrice(detail.furnitureModel)}">
                                                    <f:convertNumber type="number" groupingUsed="true" minFractionDigits="2" pattern="#0.00"/>
                                                </h:outputText>
                                            </small>
                                        </p>
                                    </td>
                                    <td class="list_quantity">
                                        <h:inputText id="quantity" value="#{detail.qty}" class="form-control list_quantity_input" p:required="true" p:type="number" p:min="1"></h:inputText>
                                    </td>
                                    <td>
                                        <h:commandButton actionListener="#{shoppingListDetailManagedBean.editDetail}" class="btn btn-sm transparent-button" style="outline:0;"> 
                                            <f:attribute name="detailid" value="#{detail}" />
                                        </h:commandButton>
                                        <i class="fa fa-lg fa-save icon-button"></i>
                                    </td>
                                    <td>
                                        <h:commandButton actionListener="#{shoppingListDetailManagedBean.deleteDetail}" class="btn btn-sm transparent-button" style="outline:0;"> 
                                            <f:param name="detailid" value="#{detail.id}" />
                                        </h:commandButton>                                            
                                        <i class="fa fa-times icon-button"></i>
                                    </td>
                                </tr>     
                                </ui:repeat>
                                </h:form>
                            </tbody>
                        </table> 
                    </div>
                    <div class="sub-total pull-right">
                        <h4><strong>Subtotal: #{shoppingListDetailManagedBean.countryOffice.country.currency.currencyCode} </strong> 
                            <h:outputText value="#{shoppingListDetailManagedBean.subtotal}">
                                <f:convertNumber type="number" groupingUsed="true" minFractionDigits="2" pattern="#0.00"/>
                            </h:outputText>  
                        </h4>    
                        <hr/>
                    </div>
                    </div>
                </h:panelGroup>
            </div>
        </section>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
