<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">
<h:body>
    <ui:composition template="../template.xhtml">
        <ui:define name="content">
            <section style="min-height: 550px;">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <ol class="breadcrumb">
                              <li><a href="index.xhtml">Home</a></li>
                              <li class="active"><strong>My Account</strong></li>
                            </ol>
                        </div>
                        <div class="col-md-12">
                            <ul class="nav nav-tabs dashboard-tabs" role="tablist">
                                <li class="active"><a href="#info" role="tab" data-toggle="tab"><i class="fa fa-user"></i> Account Info</a></li>
                                <li><a href="#perks" role="tab" data-toggle="tab"><i class="fa fa-star"></i> Perks &amp; Promotions</a></li>
                                <li><a href="#history" role="tab" data-toggle="tab"><i class="fa fa-clock-o"></i> Transaction History</a></li>                                
                                <li><a href="#settings" role="tab" data-toggle="tab"><i class="fa fa-cog"></i> Settings</a></li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="info">
                                    <div class="col-md-6">
                                        <br/>
                                        <h4>Membership Info</h4>
                                        <br/>
                                        <form class="form-horizontal">
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Your User ID <br/>(Email Address): </label>
                                            <div class="col-sm-9"><h5>#{customerAccountManagedBean.customer.emailAddress}</h5></div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Last login: </label>
                                            <div class="col-sm-9">
                                                <h5>
                                                    <h:outputText value="#{customerAccountManagedBean.customer.lastLogon}">
                                                        <f:convertDateTime pattern="EEE, MMM d, yyyy z" timeZone="#{customerAccountManagedBean.co.timeZoneID}"/>
                                                    </h:outputText>
                                                </h5>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Membership Tier: </label>
                                            <div class="col-sm-9">
                                                <h5>
                                                    <h:outputText value="#{customerAccountManagedBean.customer.membershipTier.title}"></h:outputText>
                                                    <h:outputText rendered="#{empty customerAccountManagedBean.customer.membershipTier.title}" value="Basic"></h:outputText>
                                                </h5>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Current Points Balance: </label>
                                            <div class="col-sm-9">
                                                <h5>
                                                    <h:outputText value="#{customerAccountManagedBean.customer.currentPoints}"></h:outputText>
                                                    <h:outputText rendered="#{empty customerAccountManagedBean.customer.currentPoints}" value="0"></h:outputText>
                                                </h5>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Total Points Cumulated: </label>
                                            <div class="col-sm-9">
                                                <h5>
                                                    <h:outputText value="#{customerAccountManagedBean.customer.cumulativePoints}"></h:outputText>
                                                    <h:outputText rendered="#{empty customerAccountManagedBean.customer.cumulativePoints}" value="0"></h:outputText>
                                                </h5>
                                            </div>
                                        </div>
                                        </form>
                                        <br/>
                                    </div>
                                    <div class="col-md-6">
                                        <br/>
                                        <h4>Update Your Details</h4>
                                        <br/>
                                        <h:form id="particularsForm" class="form-horizontal">
                                          <div class="form-group">
                                            <label class="col-sm-2 control-label">Name: </label>
                                            <div class="col-sm-10 inner-addon right-addon">
                                              <a href="#"><i class="glyphicon glyphicon-pencil"></i></a>
                                              <h:inputText id="name" value="#{customerAccountManagedBean.customer.name}" 
                                                 class="form-control transparent-form"></h:inputText>
                                            </div>
                                          </div>                                
                                          <div class="form-group">
                                            <label class="col-sm-2 control-label">Mobile: </label>
                                            <div class="col-sm-10 inner-addon right-addon">
                                              <a href="#"><i class="glyphicon glyphicon-pencil"></i></a>
                                              <h:inputText id="phoneNo" value="#{customerAccountManagedBean.customer.phoneNo}" 
                                                class="form-control transparent-form"></h:inputText>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label class="col-sm-2 control-label">Address: </label>
                                            <div class="col-sm-10 inner-addon right-addon">
                                              <a href="#"><i class="glyphicon glyphicon-pencil"></i></a>
                                              <h:inputText id="address" value="#{customerAccountManagedBean.customer.address}" 
                                                class="form-control transparent-form"></h:inputText>
                                            </div>
                                          </div>                                            
                                          <span class="pull-right">
                                            <h:commandButton action="#{customerAccountManagedBean.modifyPersonalParticulars}" value="Update" class="btn btn-round btn-success btn-theme"></h:commandButton>
                                            </span>
                                        </h:form>                                
                                    </div>
                                </div>
                                <div class="tab-pane" id="perks">
                                    <div class="col-md-6">
                                        <br/>
                                        <h4>Your Perks and Privileges</h4>
                                        <br/>
                                        <ul>
                                            <ui:repeat value="#{customerAccountManagedBean.pdpPerks}" var="pdp">
                                                <h:panelGroup rendered="#{pdp.percentageDiscount != 0}">
                                                <li><i class="fa fa-check-square"></i> #{customerAccountManagedBean.getPercentageDiscount(pdp.id) * 100}% discount for all #{pdp.applicablePlant.name} #{pdp.stock.name} items</li>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{pdp.absoluteDiscount != 0}">
                                                <li><i class="fa fa-check-square"></i> $#{customerAccountManagedBean.getAbsoluteDiscount(pdp.id)} discount for all #{pdp.applicablePlant.name} #{pdp.stock.name} items</li>
                                                </h:panelGroup>
                                            </ui:repeat>
                                            <ui:repeat value="#{customerAccountManagedBean.pdpcPerks}" var="pdpc">
                                                <h:panelGroup rendered="#{pdpc.percentageDiscount != 0}">
                                                <li><i class="fa fa-check-square"></i> #{customerAccountManagedBean.getPercentageDiscount(pdpc.id) * 100}% discount for all #{pdpc.applicablePlant.name} #{pdpc.category} items</li>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{pdpc.absoluteDiscount != 0}">
                                                <li><i class="fa fa-check-square"></i> $#{customerAccountManagedBean.getAbsoluteDiscount(pdpc.id)} discount for all #{pdpc.applicablePlant.name} #{pdpc.category} items</li>
                                                </h:panelGroup>                                                
                                            </ui:repeat>
                                            <ui:repeat value="#{customerAccountManagedBean.pdpscPerks}" var="pdpsc">
                                                <h:panelGroup rendered="#{pdpsc.percentageDiscount != 0}">
                                                <li><i class="fa fa-check-square"></i> #{customerAccountManagedBean.getPercentageDiscount(pdpsc.id) * 100}% discount for all #{pdpsc.applicablePlant.name} #{pdpsc.category} items</li>
                                                </h:panelGroup>
                                                <h:panelGroup rendered="#{pdpsc.absoluteDiscount != 0}">
                                                <li><i class="fa fa-check-square"></i> $#{customerAccountManagedBean.getPercentageDiscount(pdpsc.id)} discount for all #{pdpsc.applicablePlant.name} #{pdpsc.category} items</li>
                                                </h:panelGroup>                                                
                                            </ui:repeat>                                            
                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-pane" id="history">
                                    <div class="col-md-8">
                                        <br/>
                                        
                                    <ui:repeat value="#{customerAccountManagedBean.furnitureTransactions}" var="trans">    
                                    <!-- Sales Transaction -->
                                    <div class="panel panel-default receipt">
                                    <div class="panel-heading receipt-head">Transaction ID: ##{trans.id}</div>
                                      <div class="panel-body">
                                          <p>
                                              <strong>
                                                <h:outputText value="#{trans.transTime.time}">
                                                    <f:convertDateTime pattern="EEE, MMM d, yyyy HH:MM z" timeZone="#{customerAccountManagedBean.co.timeZoneID}"/>
                                                </h:outputText>
                                              </strong><br/>
                                              Store: <strong>#{trans.store.name}</strong><br/></p>
                                          <p>
                                              Returned Credits: <strong>#{trans.returnedCreditsUsed}</strong>
                                          </p>                                    
                                      </div>
                                      <div class="line"></div>
                                      <table class="table">
                                        <thead>
                                          <tr>
                                            <th>DESCRIPTION</th>
                                            <th width="130">UNIT PRICE</th>
                                            <th width="70">QTY</th>                    
                                            <th width="80" class="text-right">TOTAL</th>
                                            <th width="100" class="text-right">POINTS AWARDED</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                            <ui:repeat value="#{trans.furnitureTransactionDetails}" var="detail">
                                              <tr>
                                                <td>#{detail.furnitureModel.name}</td>
                                                <td>#{detail.unitPrice}</td>
                                                <td>#{detail.qty}</td>
                                                <td class="text-right">
                                                    <h:outputText value="#{detail.unitPrice * detail.qty}" id="discounted">
                                                        <f:convertNumber type="number" groupingUsed="true" minFractionDigits="2" pattern="#0.00"/>
                                                    </h:outputText>
                                                </td>
                                                <td class="text-right">#{detail.unitPoints * detail.qty}</td>
                                              </tr>
                                            </ui:repeat>                                       
                                          <tr>
                                            <td class="no-border"><strong>Total Receipt / Points Awarded</strong></td>
                                            <td colspan="3" class="text-right"><strong>
                                                    #{customerAccountManagedBean.co.country.currency.currencyCode} 
                                                    #{trans.grandTotal}</strong></td>
                                            <td class="text-right"><strong>#{customerAccountManagedBean.calculatePoints(trans)} pts</strong></td>
                                          </tr>
                                        </tbody>
                                      </table>                             
                                    </div>                                        
                                    </ui:repeat>
                                        
                                    </div>
                                </div>
                                <div class="tab-pane" id="settings">
                                    <div class="col-md-6">
                                        <br/>
                                        <h4>Change Password</h4>
                                        <br/>
                                        <h:form id="passwordForm" class="form-horizontal">
                                          <div class="form-group">
                                            <label class="col-sm-4 control-label">Old Password: </label>
                                            <div class="col-sm-8">
                                              <h:inputSecret id="oldPassword" class="form-control"></h:inputSecret>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label class="col-sm-4 control-label">New Password: </label>
                                            <div class="col-sm-8">
                                                <h:inputSecret id="newPassword" class="form-control"></h:inputSecret>
                                            </div>
                                          </div>
                                          <div class="form-group">
                                            <label class="col-sm-4 control-label">Confirm New Password: </label>
                                            <div class="col-sm-8">
                                              <h:inputSecret id="confirmNewPassword" class="form-control"></h:inputSecret>
                                            </div>
                                          </div>
                                          <span class="pull-right">
                                              <h:commandButton actionListener="#{customerAccountManagedBean.changePassword}" value="Change password" 
                                                class="btn btn-round btn-success btn-theme"></h:commandButton>
                                            </span>
                                        </h:form>
                                        <br/><br/><br/>
                                        <h4><i class="fa fa-warning"></i> Account Termination</h4>
                                        <hr/>
                                        We're sad to see you go, but you may remove your account here:
                                        <br/><br/>
                                        <button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#removeAccount">
                                            Remove my account
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            
                <!-- Account Removal Modal -->
                <div class="modal fade" id="removeAccount" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalLabel">Are You Sure?</h4>
                      </div>
                      <h:form id="removeCustomerAccount" class="form-horizontal">
                          <div class="modal-body">
                              <h5>In accordance with Singapore's Personal Data Protection Act (PDPA), all your account details and personal data will be removed
                                  from Island Furniture's database upon termination of your account.</h5>
                              <h5>Please enter your password to continue.</h5><br/>
                              <div class="form-group">
                                <label class="col-sm-2">Enter Password: </label>
                                <div class="col-sm-6">
                                    <h:inputSecret id="password" class="form-control"></h:inputSecret>
                                </div>
                              </div>                              
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-default btn-round" data-dismiss="modal">Cancel</button>
                            <h:commandButton action="#{customerAccountManagedBean.removeAccount}" value="Yes, remove my account" class="btn btn-danger btn-round" />
                          </div>
                      </h:form>
                    </div>
                  </div>
                </div>            
            </ui:define>
        </ui:composition>
    </h:body>
</html>
